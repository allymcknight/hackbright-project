{% extends 'base.html' %}

{% block content %}
    <!-- Show basic user info -->
    <h1>{{ user_info.user.username }}'s Profile <h1>
    <h3>Email: {{ user_info.user.email }}</h3>

    <!-- Show mood logs -->
    <p>Mood logs:</p>
    <h4><a href='/log_day_mood'>Add mood log for a day</a></h4>
    <h4><a href='/log_event_mood'>Add mood log for an event</a></h4>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.15.2/moment.min.js"></script>
    <script src=
      "https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.2.1/Chart.js">
    </script>


    <div class="mood-chart" style='height: 50vh; width: 75vw'>
      <canvas id="moodChart"></canvas>
    <div>
    <br>

    <script>
    // 'use strict';
    
        var options = { responsive: true,
                        maintainAspectRatio: false,
            // http://stackoverflow.com/questions/37061945/how-to-format-x-axis-time-scale-values-in-chart-js-v2
                        scales: {
                            xAxes: [{
                                type:'time',
                                unit: 'day',
                                unitStepSize: 1,
                                time: {
                                    displayFormats: {
                                        'day': 'MMM DD'
                                    },
                                min: '{{ user_info.day_log_range[0] }}',
                                max: '{{ user_info.day_log_range[1] }}'                                
                                } 
                            }]
                        }};

        var ctx = $('#moodChart').get(0).getContext('2d');
        $.get('/day_mood_chart.json', function (data) {
            console.log(data);
            var moodChart = new Chart(ctx, {
                type: 'line',
                data: data,
                options: options
        });
        });

    </script>        

    <!-- Show prescription logs -->
    <h3>Prescriptions:</h3>
    <h4><a href='/drugs'>Add prescription from drug list</a></h4>

    <ul>
        {% for drug, prescription_list in user_info.prescriptions.items() %}
        <li>
            <b>{{ drug }}</b>
            <ul>
                {% for prescription in prescription_list %}
                <li>
                    <a href='prescription_info/{{ prescription.prescription_id }}'>
                        Dosage: {{ prescription.dosage }},
                        Frequency: {{ prescription.frequency }}
                    </a>
                    <!-- Notes whether prescription is active -->
                    {% if not prescription.end_date %}[ ACTIVE ]{% endif %}
                </li>
                {% endfor %}
            </ul>
        </li>
        {% endfor %}
    </ul>


{% endblock %}    