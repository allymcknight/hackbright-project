{% extends 'base.html' %}

{% block content %}
    <h1>Log your mood for a day:</h1>
    <form id='day-mood-form' action='/log_day_mood' method='POST'>
        <label for='date'>Date: </label>
        <input type="text" id="date" name="date" readonly="true" required><br>

        <label for='overall-mood'>Overall Mood: </label>
        <input id='overall-mood' type='number' name='overall-mood' min='-50' max='50' required><br>

        <p id='mood-range'>Range of Mood: 
        <label for='min-mood'>Min: </label>
        <input id='min-mood' type='number' name='min-mood' min='-50' max='50'>

        <label for='max-mood'>Max: </label>
        <input id='max-mood' type='number' name='max-mood' min='-50' max='50'>
        <span id="alert-msg" style='color:red;'></span><br>
        </p>

        <label for='notes'>Notes About This Day:</label>
        <input id='notes' type='textarea' name='notes'><br>

        <input type='submit' value='Add Day Mood Log'>
    </form>

    <!-- To use the jquery ui datepicker -->
    <link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
    <script>
        // When DOM is ready, turn date input to datepicker
        // |safe allows the python list to become a js array (if not the '[]' become something else)
        var excludeDates = {{ logged_days|safe }};
        $( function() {
            $("#date").datepicker({            
                minDate: '-1M',
                maxDate: new Date(),
                dateFormat: 'yy-mm-dd',
                // beforeShowDay takes a date from the calendar and returns an array
                // returns [t/f slectable, css class name to add '' if none, optional popup tooltip]
                beforeShowDay: function(date) {
                    // turn date from datepicker into a str
                    var dateStr = $.datepicker.formatDate('yy-mm-dd', date);
                    console.log(dateStr);
                    // return whether dateStr is in excludeDates --> 
                    // array.indexOf(item) returns -1 if item not in array
                    return [excludeDates.indexOf(dateStr) == -1]
                }

            });
        });

    </script>

    <script>
        function validateMoodRange(evt){
            var overallMood = $('#overall-mood').val()
            var minMood = $('#min-mood').val()
            var maxMood = $('#max-mood').val()

            if ((minMood && maxMood)) {
                // .val() returns str, need to make it int for comparisons
                overallMood = parseInt(overallMood)
                minMood = parseInt(minMood)
                maxMood = parseInt(maxMood)

                if (minMood > maxMood) {
                    var msg = '** Min should not be greater than max **'
                    // evt.preventDefault();
                    // $('#alert-msg').html('** Min should not be greater than max **');
                }
                else if (!((minMood < overallMood) && (overallMood < maxMood))) {
                    var msg = '** Overall mood should be within mood range **'
                    // evt.preventDefault();
                    // $('#alert-msg').html('** Overall mood should be within mood range **');
                }
            }
            else if ((!minMood && maxMood) || (!maxMood && minMood)) {
                var msg = '** Both min and max must be entered or empty**';
            }

            if (msg) {
                evt.preventDefault();
                $('#alert-msg').html(msg);
            }
        }

        $('#day-mood-form').on('submit', validateMoodRange);

    </script>


{% endblock %}